<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>typing-ru sample</title>

</head>
<body>
Q: <div id="question"></div>
<div id="typed" style="color: red;"></div>
<div id="answer"></div>
Time: <div id="sec"></div>

<script type="text/javascript">
     document.onkeydown = keydown; 
     window.onload = run();

     var rusKeycodes = new Array();
     rusKeycodes = {
      65:"ф",
      66:"и",
      67:"с",
      68:"в",
      69:"у",
      70:"а",
      71:"п",
      72:"р",
      73:"ш",
      74:"о",
      75:"л",
      76:"д",
      77:"ь",
      78:"т",
      79:"щ",
      80:"з",
      81:"й",
      82:"к",
      83:"ы",
      84:"е",
      85:"г",
      86:"м",
      87:"ц",
      88:"ч",
      89:"н",
      90:"я",
      48:"0",
      49:"1",
      50:"2",
      51:"3",
      52:"4",
      53:"5",
      54:"6",
      55:"7",
      56:"8",
      57:"9",
      186:"э",
      187:"ж",
      188:"б",
      189:"-",
      190:"ю",
      191:".",
      192:"х",
      219:"ъ",
      222:"="};
      var rusAlphabet = new Array();


      //rusKeycodes.forEach(function(value){
        for (var key in rusKeycodes){
          var newkey = rusKeycodes[key];
          rusAlphabet[newkey] = key;
        }
        
      //});


     var word = "доброеутроменязовутсей"; //問題
     var keycodes = new Array();
     wordtoArray = word.split("");
     wordtoArray.forEach(function(value) { //convert to keycode array
        keycodes.push(rusAlphabet[value]);
     });

     console.log(keycodes);
     var charnum = 0;
     var maxchar = keycodes.length;

      var question = document.getElementById("question");
      question.innerHTML = word; //Show question
      var target = document.getElementById("answer");
      var typed = document.getElementById("typed");
      var timecount = document.getElementById("timecount");
      var typedtxt = new Array(); //Show typed text by user

      //timecount
      var startTime,
      timerId;

      function run() {
        startTime = (new Date()).getTime(); //set start time
        timer();
      }

      function stop() { //stop timecount
        clearTimeout(timerId);
      }

      function timer() {
        document.getElementById('sec').innerHTML = (((new Date()).getTime() - startTime) / 1000).toFixed(2);
        timerId = setTimeout(function() { 
          timer(); //0.1 sec ごとにtimer function を実行。これでタイマーが動く。
        }, 100);
    
      }
      //When keyeown
     function keydown() {
        if(keycodes[charnum] == event.keyCode) { //good typed
          target.innerHTML = "OK" + event.keyCode;
          charnum += 1;
          addchar = word.substr(0, charnum); //get character typed by user
          //typedtxt.push();
          typed.innerHTML = addchar;
            if (charnum == maxchar){ //when last character
              target.innerHTML = "Clear" + event.keyCode;
              charnum = 0;
              stop();
            }
        }  else { //bad typed
          target.innerHTML = "NG" + event.keyCode;
        }

      }
</script>

</body>
</html>